var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(c){var a=0;return function(){return a<c.length?{done:!1,value:c[a++]}:{done:!0}}};$jscomp.arrayIterator=function(c){return{next:$jscomp.arrayIteratorImpl(c)}};$jscomp.makeIterator=function(c){var a="undefined"!=typeof Symbol&&Symbol.iterator&&c[Symbol.iterator];return a?a.call(c):$jscomp.arrayIterator(c)};document.getElementById("enc").onclick=function(){do_encrypt()};document.getElementById("dec").onclick=function(){do_decrypt()};
function download(c,a,b){c=new Blob([c],{type:b});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(c,a);else{var d=document.createElement("a"),f=URL.createObjectURL(c);d.href=f;d.download=a;document.body.appendChild(d);d.click();setTimeout(function(){document.body.removeChild(d);window.URL.revokeObjectURL(f)},0)}}
function do_encrypt(){do_genrsa();var c=new RSAKey;c.setPublic(document.rsatest.n.value,document.rsatest.e.value);var a=document.getElementById("file").files[0],b=new FileReader;b.readAsArrayBuffer(a);b.onerror=function(){console.log(b.error)};b.onload=function(){var d=new Uint8Array(b.result);if(500<d.byteLength){var f=[],e=0,g,h=document.rsatest.ciphertext.value="";d=$jscomp.makeIterator(d);for(var k=d.next();!k.done;k=d.next())h+=k.value+" ";for(d=h.length;500<d;)f.push(h.slice(e,e+500)),e+=500,
d-=500;f.push(h.slice(e,b.result.length));f.forEach(function(m){if(g=c.encrypt(m))document.rsatest.ciphertext.value=document.rsatest.ciphertext.value+"\n"+linebrk(g,64)})}else if(g=c.encrypt(b.result))document.rsatest.ciphertext.value=linebrk(g,64);download(a.name.split(".").pop()+"\n"+document.rsatest.n.value+"\n"+document.rsatest.d.value+document.rsatest.ciphertext.value,a.name.split(".")[0]+".sc",Text)}}
function do_decrypt(){var c=document.getElementById("file").files[0],a=new FileReader;a.readAsText(c);a.onerror=function(){console.log(a.error)};a.onload=function(){var b=a.result.indexOf("\n"),d=a.result.slice(0,b),f=new RSAKey,e=document.rsatest;e.e.value=3;e.n.value=a.result.slice(b+1,b+1024+16);b+=1040;e.d.value=a.result.slice(b+1,b+1024+16);b+=1040;f.setPrivate(e.n.value,e.e.value,e.d.value);b=a.result.slice(b+1,a.result.length);var g=0,h="",k="";if(1039<b.length){var m=b.split("\n");m.forEach(function(p){h=
h+p+"\n";g++;if(0===g%16&&0!=g||g===m.length)l=f.decrypt(h),null==l?(k="*** Invalid Ciphertext ***",console.log("*** Invalid Ciphertext ***")):(k+=l,h="")})}else{var l=f.decrypt(b);null==l?(k="*** Invalid Ciphertext ***",console.log("*** Invalid Ciphertext ***")):k=l}b=k.split(" ");e=new ArrayBuffer(b.length);for(var q=new Uint8Array(e),n=0;n<b.length;n++)q[n]=b[n];download(e,c.name.split(".")[0]+"."+d,ArrayBuffer)}}
function do_genrsa(){var c=new RSAKey,a=document.rsatest;c.generate(4096,a.e.value);a.n.value=linebrk(c.n.toString(16),64);a.d.value=linebrk(c.d.toString(16),64)};