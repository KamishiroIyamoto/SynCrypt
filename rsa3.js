function download(e,t,n){var l=new Blob([e],{type:n});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(l,t);else{var r=document.createElement("a"),o=URL.createObjectURL(l);r.href=o,r.download=t,document.body.appendChild(r),r.click(),setTimeout(function(){document.body.removeChild(r),window.URL.revokeObjectURL(o)},0)}}function do_encrypt(){do_genrsa();var e=new RSAKey;e.setPublic(document.rsatest.n.value,document.rsatest.e.value);let t=document.getElementById("file").files[0],n=new FileReader;n.readAsArrayBuffer(t),n.onerror=function(){console.log(n.error)},n.onload=function(){let l=new Uint8Array(n.result);if(l.byteLength<=500){for(var r=new Uint8Array(501),o=0;o<501;o++)o<l.byteLength-1?r[o]=l[o]:r[o]=32;l=r}let a=new Array,c=0;var u;document.rsatest.ciphertext.value="";let i="";for(let e of l)i+=e+" ";let d=i.length;for(;d>500;)a.push(i.slice(c,c+500)),c+=500,d-=500;a.push(i.slice(c,n.result.length)),a.forEach(t=>{(u=e.encrypt(t))&&(document.rsatest.ciphertext.value=document.rsatest.ciphertext.value+"\n"+linebrk(u,64))}),download(t.name.split(".").pop()+"\n"+document.rsatest.n.value+"\n"+document.rsatest.d.value+document.rsatest.ciphertext.value,t.name.split(".")[0]+".sc",Text)}}function do_decrypt(){let e=document.getElementById("file").files[0],t=new FileReader;t.readAsText(e),t.onerror=function(){console.log(t.error)},t.onload=function(){let n=t.result.indexOf("\n"),l=t.result.slice(0,n);var r=new RSAKey,o=document.rsatest;o.e.value=3,o.n.value=t.result.slice(n+1,n+1024+16),n+=1040,o.d.value=t.result.slice(n+1,n+1024+16),n+=1040,r.setPrivate(o.n.value,o.e.value,o.d.value);let a=t.result.slice(n+1,t.result.length);var c;let u=0,i="",d="",s=a.split("\n");s.forEach(e=>{i=i+e+"\n",(++u%16==0&&0!=u||u===s.length)&&(null==(c=r.decrypt(i))?(d="*** Invalid Ciphertext ***",console.log("*** Invalid Ciphertext ***")):(d+=c,i=""))});let f=d.split(" ");if(""==f[f.length-1]||"32"==f[f.length-2]&&"32"==f[f.length-3]){let e=0;for(var v=f.length-2;v>=0;v--)if("32"!=f[v]){e=v;break}f=f.slice(0,e+1)}let m=new ArrayBuffer(f.length),p=new Uint8Array(m);for(let e=0;e<f.length;e++)p[e]=f[e];download(m,e.name.split(".")[0]+"."+l,ArrayBuffer)}}function do_genrsa(){var e=new RSAKey,t=document.rsatest;e.generate(parseInt(4096),t.e.value),t.n.value=linebrk(e.n.toString(16),64),t.d.value=linebrk(e.d.toString(16),64)}document.getElementById("enc").onclick=function(){do_encrypt()},document.getElementById("dec").onclick=function(){do_decrypt()},document.querySelector("#file").on=function(){document.getElementById("span").value=document.querySelector("input[type=file]").files[0].name};